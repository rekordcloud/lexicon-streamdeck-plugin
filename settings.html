<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <title>cloud.rekord.lexicon settings</title>
  <link rel="stylesheet" href="sdpi.css">
  <script src="common.js"></script>

  <style>
    .sdpi-hidden {
      display: none;
    }

    input {
      padding: 0 5px;
    }
  </style>
</head>

<body>
  <div id="lexiconSettings" class="sdpi-wrapper sdpi-hidden">
    <div type="select" class="sdpi-item">
      <div class="sdpi-item-label">Action</div>
      <select id="lexiconActionSelect" class="sdpi-item-value select" required onchange="onInputChange()">
        <optgroup label="Application">
          <option value="Application_OpenSettings">Open settings</option>
          <option value="Application_OpenHelp">Open help</option>
          <option value="Application_OpenSearch">Open search</option>
          <option value="Application_OpenActionCenter">Open action center</option>
          <option value="Application_OpenUndo">Open undo history</option>
          <option value="Application_CheckForUpdates">Check For Updates</option>
          <option value="Application_OpenDuplicateTracksDialog">Open Duplicate Tracks Dialog</option>
          <option value="Application_OpenUnusedFilesDialog">Open Unused Files Dialog</option>
          <option value="Application_OpenBrokenTracksDialog">Open Broken Tracks Dialog</option>
          <option value="Application_OpenRelocateDialog">Open Relocate Dialog</option>
          <option value="Application_OpenReencodeFilesDialog">Open Reencode Files Dialog</option>
          <option value="Application_OpenStreamingTransferDialog">Open Streaming Transfer Dialog</option>
          <option value="Application_OpenPlaylistOccurrenceDialog">Open Playlist Occurrence Dialog</option>
          <option value="Application_OpenImportTagsFromFileDialog">Open Import Tags From File Dialog</option>
          <option value="Application_OpenBackupCreateDialog">Open Backup Create Dialog</option>
          <option value="Application_OpenBackupRestoreDialog">Open Backup Restore Dialog</option>
          <option value="Application_OpenBackupCloudDialog">Open Backup Cloud Dialog</option>
          <option value="Application_OpenCleanupDialog">Open Cleanup Dialog</option>
          <option value="Application_OpenUserFeedbackDialog">Open User Feedback Dialog</option>
          <option value="Application_OpenIntegrityCheckDialog">Open Integrity Check Dialog</option>
          <option value="Appearance_ToggleTheme">Toggle theme</option>
          <option value="Application_ToggleWindow">Toggle window</option>
        </optgroup>
        <optgroup label="Navigation">
          <option value="Navigation_ToggleSidebar">Toggle sidebar</option>
          <option value="Navigation_ToggleBeatgridControls">Toggle beatgrid/jump</option>
          <option value="Navigation_ToggleSidepanel">Toggle sidepanel</option>
          <option value="Navigation_SidebarTracksAll">Sidebar: All Tracks</option>
          <option value="Navigation_SidebarTracksIncoming">Sidebar: Incoming</option>
          <option value="Navigation_SidebarTracksArchive">Sidebar: Archive</option>
          <option value="Navigation_SidebarTags">Sidebar: Custom Tags</option>
          <option value="Navigation_SidebarSync">Sidebar: Sync</option>
          <option value="Navigation_SidebarImport">Sidebar: Import</option>
          <option value="Navigation_SidebarTrackMatcher">Sidebar: Track Matcher</option>
          <option value="Navigation_SidebarCharts">Sidebar: Charts</option>
          <option value="Navigation_SidebarStoreLinks">Sidebar: Store Links</option>
          <option value="Navigation_SidebarStatistics">Sidebar: Statistics</option>
          <option value="Navigation_SidebarBeatport">Sidebar: Beatport</option>
          <option value="Navigation_FocusPlaylistsFilter">Focus playlists filter</option>
        </optgroup>
        <optgroup label="Track Browser">
          <option value="Incoming_SelectedDone">Incoming: Mark selected done</option>
          <option value="Incoming_ForceRefresh">Incoming: Refresh watch folder</option>
          <option value="Navigation_SelectCurrentPlaying">Find currently loaded track</option>
          <option value="Navigation_EditCurrentPlaying">Edit currently loaded track</option>
          <option value="TrackBrowser_FocusFilter_Title">Focus filter: Title</option>
          <option value="TrackBrowser_FocusFilter_Artist">Focus filter: Artist</option>
          <option value="TrackBrowser_FocusFilter_Genre">Focus filter: Genre</option>
          <option value="TrackBrowser_FocusFilter_Comment">Focus filter: Comment</option>
          <option value="TrackBrowser_ClearFilter">Clear filters</option>
          <option value="TrackBrowser_Analyze">Selected tracks: Analyze</option>
          <option value="TrackBrowser_ReloadTags">Selected tracks: Reload tags</option>
          <option value="TrackBrowser_Relocate">Selected tracks: Relocate</option>
          <option value="TrackBrowser_OpenFolder">Selected tracks: Open folder</option>
          <option value="CloudFileBackup_UploadSelected">Selected tracks: Upload to cloud</option>
          <option value="Application_ArchiveSelected">Selected tracks: Archive</option>
          <option value="TrackBrowser_CuePointGenerator">Selected tracks: Generate cue points</option>
          <option value="TrackBrowser_Discovery">Selected tracks: Discover new tracks</option>
          <option value="TrackBrowser_TagLookup">Selected tracks: Find tags & album art</option>
          <option value="TrackBrowser_TagWriter">Selected tracks: Write tags to file</option>
          <option value="TrackBrowser_MixableTracks">Selected tracks: Find mixable tracks</option>
        </optgroup>
        <optgroup label="Editing">
          <option value="Application_OpenEditor">Open editor</option>
          <option value="Application_OpenTags">Open Custom Tags editor</option>
          <option value="Application_ApplyCuepointGeneratorTemplatePlayingTrack">Apply generator template to playing track</option>
          <option value="Application_ApplyCuepointGeneratorTemplateSelectedTracks">Apply generator template to selected tracks</option>
          <option value="Application_SetRating">Set rating</option>
          <option value="Application_SetColor">Set color</option>
          <option value="Application_SetColor_None">Remove color</option>
          <option value="Application_SetEnergy">Set energy</option>
          <option value="Application_SetDanceability">Set danceability</option>
          <option value="Application_SetPopularity">Set popularity</option>
          <option value="Application_SetHappiness">Set happiness</option>
          <option value="Application_Tags_AddShortcut">Add Custom Tag(s) assigned to shortcut</option>
          <option value="Application_Tags_ToggleShortcut">Toggle Custom Tag(s) assigned to shortcut</option>
          <option value="Application_Tags_Clear">Remove all Custom Tags</option>
        </optgroup>
        <optgroup label="Music Player">
          <option value="MusicPlayer_Play">Play</option>
          <option value="MusicPlayer_Pause">Pause</option>
          <option value="MusicPlayer_TogglePlay">Play/Pause</option>
          <option value="MusicPlayer_Next">Next</option>
          <option value="MusicPlayer_Previous">Previous</option>
          <option value="MusicPlayer_Eject">Eject</option>
          <option value="MusicPlayer_ToggleQuantize">Toggle quantize</option>
          <option value="MusicPlayer_ZoomIn">Zoom in</option>
          <option value="MusicPlayer_ZoomOut">Zoom out</option>
          <option value="MusicPlayer_FocusBpmField">Focus BPM field</option>
          <option value="MusicPlayer_ClearQueue">Clear queue</option>
          <option value="MusicPlayer_ShuffleQueue">Shuffle queue</option>
        </optgroup>
        <optgroup label="Cues">
          <option value="MusicPlayer_Cue">Cue</option>
          <option value="MusicPlayer_CuePlay">Cue Play</option>
          <option value="MusicPlayer_DeleteHotcue">Delete cue</option>
          <option value="MusicPlayer_CreateHotcue">Create cue</option>
          <option value="MusicPlayer_AddEmptyCue">Add empty cue</option>
          <option value="MusicPlayer_AddCueAsLast">Add cue as last</option>
          <option value="MusicPlayer_DeletePreviousCue">Delete previous cue</option>
          <option value="MusicPlayer_Hotcue">Cue</option>
          <option value="MusicPlayer_LoopCreate">Turn cue into loop of size</option>
          <option value="MusicPlayer_LoopDouble">Double loop size</option>
          <option value="MusicPlayer_LoopHalve">Halve loop size</option>
          <option value="MusicPlayer_LoopToggleActive">Toggle active loop</option>
        </optgroup>
        <optgroup label="Beatgrid">
          <option value="MusicPlayer_TempomarkerSet">Move marker to current position</option>
          <option value="MusicPlayer_TempomarkerFind">Jump to next marker</option>
          <option value="MusicPlayer_TempomarkerAdd">Add marker at current position</option>
          <option value="MusicPlayer_TempomarkerRemove">Delete current marker</option>
          <option value="MusicPlayer_TempomarkerDoubleBpm">Double current marker BPM</option>
          <option value="MusicPlayer_TempomarkerHalveBpm">Halve current marker BPM</option>
          <!-- <option value="MusicPlayer_TempomarkerMoveGridLeft">Move current marker left</option> -->
          <!-- <option value="MusicPlayer_TempomarkerMoveGridRight">Move current marker right</option> -->
          <!-- <option value="MusicPlayer_TempomarkerIncreaseBpm">Increase current marker BPM</option> -->
          <!-- <option value="MusicPlayer_TempomarkerDecreaseBpm">Decrease current marker BPM</option> -->
          <option value="MusicPlayer_ToggleMetronome">Toggle metronome</option>
          <option value="MusicPlayer_TempomarkerTapBpm">Tap BPM</option>
        </optgroup>
        <optgroup label="Track Jump">
          <option value="MusicPlayer_JumpBeats">Jump forward/backward beats</option>
          <option value="MusicPlayer_JumpStart">Jump to start</option>
          <option value="MusicPlayer_JumpEnd">Jump to end</option>
          <option value="MusicPlayer_JumpSeconds">Jump forward/backwards seconds</option>
        </optgroup>
        <optgroup label="Cue Templates">
          <option value="MusicPlayer_ApplyCueTemplate">Apply cue template</option>
        </optgroup>
        <optgroup label="Playlists">
          <option value="Navigation_ExpandPlaylists">Expand all playlists</option>
          <option value="Navigation_CollapsePlaylists">Collapse all playlists</option>
          <option value="Playlists_NewPlaylist">New playlist</option>
          <option value="Playlists_NewSmartlist">New smartlist</option>
          <option value="Playlists_NewFolder">New playlist folder</option>
          <option value="Playlists_SetAsFavorite">Set playlist as favorite</option>
          <option value="Playlists_Duplicate">Duplicate playlist</option>
          <option value="Playlists_EditSmartlist">Edit smartlist</option>
          <option value="Playlists_DuplicateAsPlaylist">Duplicate as playlist</option>
          <option value="FavoritePlaylists_ShowPlaylist">Show favorite playlist</option>
          <option value="FavoritePlaylists_AddSelectedTracks">Add selected tracks to fav. playlist</option>
        </optgroup>
        <optgroup label="Beatport">
          <option value="Beatport_AddSelectedToCart">AddSelectedToCart</option>
          <option value="Beatport_RemoveSelectedFromCart">RemoveSelectedFromCart</option>
          <option value="Beatport_NextPage">NextPage</option>
          <option value="Beatport_PreviousPage">PreviousPage</option>
          <option value="Beatport_AddPlayingToCart">Add playing track to cart</option>
          <option value="Beatport_TabsBeatportCatalog">Tabs: Beatport Catalog</option>
          <option value="Beatport_TabsTop">Tabs: Top</option>
          <option value="Beatport_TabsHype">Tabs: Hype</option>
          <option value="Beatport_TabsCharts">Tabs: Charts</option>
          <option value="Beatport_TabsMyBeatport">Tabs: My Beatport</option>
          <option value="Beatport_TabsMyCart">Tabs: My Cart</option>
        </optgroup>
        <optgroup label="Plugins">
          <option value="PluginRunActionByName">Run action</option>
        </optgroup>
      </select>
    </div>

    <div type="range" class="sdpi-item sdpi-hidden" id="lexiconIndexRow">
      <div class="sdpi-item-label">Number</div>
      <div class="sdpi-item-value">
        <input id="lexiconIndexInput" type="number" min="1" max="24" step="1" value="0" oninput="onInputChange()">
      </div>
    </div>

    <div type="range" class="sdpi-item sdpi-hidden" id="lexiconAmountRow">
      <div class="sdpi-item-label">Amount</div>
      <div class="sdpi-item-value">
        <input id="lexiconAmountInput" placeholder="0, 1, 2, etc" type="number" min="0" step="1" value="0" oninput="onInputChange()">
      </div>
    </div>

    <div type="range" class="sdpi-item sdpi-hidden" id="lexiconBeatsRow">
      <div class="sdpi-item-label">Beats</div>
      <div class="sdpi-item-value">
        <input id="lexiconBeatsInput" placeholder="E.g. 128 or -64" type="number" min="0" step="8" value="0" oninput="onInputChange()">
      </div>
    </div>

    <div type="select" class="sdpi-item" id="lexiconColorRow">
      <div class="sdpi-item-label">Action</div>
      <select id="lexiconColorInput" class="sdpi-item-value select" required onchange="onInputChange()">
        <option value="null">No Color</option>
        <option value="red_dark">Red Dark</option>
        <option value="red">Red</option>
        <option value="red_light">Red Light</option>
        <option value="red_orange">Red Orange</option>
        <option value="orange">Orange</option>
        <option value="beige">Beige</option>
        <option value="yellow_dark">Yellow Dark</option>
        <option value="yellow">Yellow</option>
        <option value="lime">Lime</option>
        <option value="green_light">Green Light</option>
        <option value="green">Green</option>
        <option value="green_dark">Green Dark</option>
        <option value="teal">Teal</option>
        <option value="aqua">Aqua</option>
        <option value="aqua_dark">Aqua Dark</option>
        <option value="blue_light">Blue Light</option>
        <option value="blue">Blue</option>
        <option value="blue_dark">Blue Dark</option>
        <option value="blue_violet">Blue Violet</option>
        <option value="violet">Violet</option>
        <option value="violet_light">Violet Light</option>
        <option value="magenta">Magenta</option>
        <option value="magenta_dark">Magenta Dark</option>
        <option value="magenta_red">Magenta Red</option>
        <option value="grey_light">Grey Light</option>
        <option value="grey_dark">Grey Dark</option>
        <option value="black">Black</option>
        <option value="white">White</option>
      </select>
    </div>

    <div type="range" class="sdpi-item sdpi-hidden" id="lexiconPluginNameRow">
      <div class="sdpi-item-label">Plugin</div>
      <div class="sdpi-item-value">
        <input id="lexiconPluginNameInput" placeholder="Example Plugin" type="text" oninput="onInputChange()">
      </div>
    </div>

    <div type="range" class="sdpi-item sdpi-hidden" id="lexiconPluginActionNameRow">
      <div class="sdpi-item-label">Action</div>
      <div class="sdpi-item-value">
        <input id="lexiconPluginActionNameInput" placeholder="Count Tracks" type="text" oninput="onInputChange()">
      </div>
    </div>
  </div>

  <script>
    var pluginAction = null
    var uuid = ''

    if ($SD) {
      $SD.on('connected', function (jsonObj) {
        document.querySelector('#lexiconSettings').classList.remove('sdpi-hidden')

        uuid = jsonObj['uuid']

        const action = jsonObj.actionInfo.payload.settings.action
        const index = jsonObj.actionInfo.payload.settings.index
        const amount = jsonObj.actionInfo.payload.settings.amount
        const beats = jsonObj.actionInfo.payload.settings.beats
        const color = jsonObj.actionInfo.payload.settings.color
        const pluginName = jsonObj.actionInfo.payload.settings.pluginName || ''
        const pluginActionName = jsonObj.actionInfo.payload.settings.pluginActionName || ''

        renderOptions(action)

        document.querySelector('#lexiconActionSelect').value = action
        document.querySelector('#lexiconIndexInput').value = index
        document.querySelector('#lexiconAmountInput').value = amount
        document.querySelector('#lexiconBeatsInput').value = beats
        document.querySelector('#lexiconColorInput').value = color
        document.querySelector('#lexiconPluginNameInput').value = pluginName
        document.querySelector('#lexiconPluginActionNameInput').value = pluginActionName

        if (jsonObj.hasOwnProperty('actionInfo')) {
          pluginAction = jsonObj.actionInfo.action
        }
      })
    }

    function onInputChange () {
      const actionEl = document.querySelector('#lexiconActionSelect')
      const indexEl = document.querySelector('#lexiconIndexInput')
      const amountEl = document.querySelector('#lexiconAmountInput')
      const beatsEl = document.querySelector('#lexiconBeatsInput')
      const colorEl = document.querySelector('#lexiconColorInput')
      const pluginNameEl = document.querySelector('#lexiconPluginNameInput')
      const pluginActionNameEl = document.querySelector('#lexiconPluginActionNameInput')

      const action = actionEl.value
      const index = Number(indexEl.value)
      const amount = Number(amountEl.value)
      const beats = Number(beatsEl.value)
      const color = colorEl.value
      const pluginName = pluginNameEl.value
      const pluginActionName = pluginActionNameEl.value

      renderOptions(action)

      if ($SD && $SD.connection) {
        var payload = {
          action,
          index,
          amount,
          beats,
          color,
          pluginName,
          pluginActionName
        }

        $SD.api.sendToPlugin(uuid, pluginAction, payload)
      }
    }

    function renderOptions (action) {
      if ([
        'MusicPlayer_Hotcue',
        'MusicPlayer_CreateHotcue',
        'MusicPlayer_DeleteHotcue',
        'MusicPlayer_ApplyCueTemplate'
      ].includes(action)) {
        document.querySelector('#lexiconIndexRow').classList.remove('sdpi-hidden')
      } else {
        document.querySelector('#lexiconIndexRow').classList.add('sdpi-hidden')
      }

      if ([
        'Application_SetRating',
        'Application_SetEnergy',
        'Application_SetDanceability',
        'Application_SetPopularity',
        'Application_SetHappiness',
        'Application_Tags_AddShortcut',
        'Application_Tags_ToggleShortcut',
        'FavoritePlaylists_ShowPlaylist',
        'FavoritePlaylists_AddSelectedTracks'
      ].includes(action)) {
        document.querySelector('#lexiconAmountRow').classList.remove('sdpi-hidden')
      } else {
        document.querySelector('#lexiconAmountRow').classList.add('sdpi-hidden')
      }

      if ([
        'MusicPlayer_JumpBeats',
        'MusicPlayer_JumpSeconds',
        'MusicPlayer_LoopCreate'
      ].includes(action)) {
        document.querySelector('#lexiconBeatsRow').classList.remove('sdpi-hidden')
      } else {
        document.querySelector('#lexiconBeatsRow').classList.add('sdpi-hidden')
      }

      if (['Application_SetColor'].includes(action)) {
        document.querySelector('#lexiconColorRow').classList.remove('sdpi-hidden')
      } else {
        document.querySelector('#lexiconColorRow').classList.add('sdpi-hidden')
      }

      if (action === 'PluginRunActionByName') {
        document.querySelector('#lexiconPluginNameRow').classList.remove('sdpi-hidden')
        document.querySelector('#lexiconPluginActionNameRow').classList.remove('sdpi-hidden')
      } else {
        document.querySelector('#lexiconPluginNameRow').classList.add('sdpi-hidden')
        document.querySelector('#lexiconPluginActionNameRow').classList.add('sdpi-hidden')
      }
    }
  </script>

</body>

</html>
